<!DOCTYPE module SYSTEM "module.dtd">

<module name="nederdrone_yaw_dynamic" dir="rigid_body_model">
  <doc>
    <description>Angular acceleration estimation for Nederdrone rigid body yaw dynamic. 
        The model has been estimated using the 'robustfit' Matlab routine, which returns the coefficient of the least squared model. The model is defined as following:
        yaw_angular_acceleration = alpha_1 * (yaw_angular_speed_deg)^2 * sign(yaw_angular_speed_deg) + alpha_2 * propeller_contribution_PPRZ_CMD + 
                                   alpha_3 * propeller_derivative_contribution_PPRZ_CMD + alpha_4 * control_surfaces_contribution_deg.
        The input contributions are calculated given the input provided to the actuator from the controller and their respective dynamic.

    </description>
    
    <define name="ALPHA_1" value="-0.032"     description="Angular rate coefficient"/>
    <define name="ALPHA_2" value="0.0"        description="Propeller contribution"/>
    <define name="ALPHA_3" value="0.0368"     description="Propeller derivative contribution"/>
    <define name="ALPHA_4" value="4.652"      description="Control surface contribution"/>
    <define name="PROPELLER_POLE" value="18"  description="Pole propeller first order dynamic" />
    <define name="SERVO_POLE" value="50"      description="Pole servo first order dynamic" />


     </doc>

  <settings>
    <dl_settings name="ND_yaw_dyn">
      <dl_settings name="Yaw_dyn_param">
        <dl_setting var="ND_pole" min="-30.0" step="-0.1" max="-0.1" shortname="LTI_pole" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_pole"/>
        <dl_setting var="g_prop" min="-0.03" step="0.002" max="0.03" shortname="gProp" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_g_prop"/>
        <dl_setting var="g_servo" min="1.0" step="0.1" max="10.0" shortname="gServo" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_g_servo"/>
        <dl_setting var="Q_val" min="0.0" step="0.5" max="50.0" shortname="Q_KF" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_Q"/>
        <dl_setting var="R_11_val" min="0.0" step="0.5" max="50.0" shortname="R11_KF" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_R11"/>
        <dl_setting var="R_22_val" min="0.0" step="5.0" max="500.0" shortname="R22_KF" type="float" module="rigid_body_model/nederdrone_yaw_dynamic" handler="rset_R22"/>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="nederdrone_yaw_dynamic.h"/>
  </header>

  <init fun="yaw_dynamic_init()"/>
  <periodic fun="yaw_dynamic_run()" freq="1" autorun="TRUE"/> 
  <!-- <periodic fun="yaw_dynamic_run()" freq="PERIODIC_FREQUENCY" autorun="TRUE"/>  -->
  <makefile>
    <file name="nederdrone_yaw_dynamic.c" />
  </makefile>
<!-- can I put freq="PERIODIC_FREQUENCY" so the system is synchronized with the INDI controller? -->
  <!-- <makefile>
    <file name="pprz_random.c" dir="math"/>
  </makefile> -->
</module>
